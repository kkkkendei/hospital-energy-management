{"ast":null,"code":"import Vue from 'vue';\nimport Vuex from 'vuex';\nimport axios from 'axios';\nVue.use(Vuex);\nconst authModule = {\n  namespaced: true,\n  state: {\n    user: null,\n    // 可以存储用户信息对象\n    token: localStorage.getItem('user-token') || ''\n  },\n  mutations: {\n    SET_TOKEN(state, token) {\n      state.token = token;\n      localStorage.setItem('user-token', token); // 持久化token\n      axios.defaults.headers.common['Authorization'] = `Bearer ${token}`; // 设置axios请求头\n    },\n    CLEAR_TOKEN(state) {\n      state.token = '';\n      localStorage.removeItem('user-token');\n      delete axios.defaults.headers.common['Authorization'];\n    },\n    SET_USER(state, user) {\n      state.user = user;\n      // 你也可以将用户信息存储在localStorage，但要注意敏感信息\n    },\n    CLEAR_USER(state) {\n      state.user = null;\n    }\n  },\n  actions: {\n    // 登录action (恢复为模拟API调用)\n    async login({\n      commit\n    }, credentials) {\n      try {\n        // const response = await axios.post('/auth/signin', credentials);\n        // 模拟API调用成功\n        const response = await new Promise(resolve => setTimeout(() => resolve({\n          data: {\n            token: 'fake-jwt-token-for-' + credentials.username,\n            user: {\n              username: credentials.username,\n              role: 'USER'\n            } // 模拟用户信息\n          }\n        }), 500));\n        const token = response.data.token;\n        const user = response.data.user;\n        commit('SET_TOKEN', token);\n        commit('SET_USER', user);\n        return Promise.resolve(user);\n      } catch (error) {\n        commit('CLEAR_TOKEN');\n        commit('CLEAR_USER');\n        return Promise.reject(error); // 恢复原始错误处理\n      }\n    },\n    // 注册action (恢复为模拟API调用)\n    async register(_context, userData) {\n      try {\n        // const response = await axios.post('/auth/signup', userData);\n        // 模拟API调用成功\n        console.log('Registering user (simulation):', userData);\n        await new Promise(resolve => setTimeout(() => resolve({\n          data: {\n            message: 'Registration successful (simulation)'\n          }\n        }), 500));\n        return Promise.resolve({\n          message: 'Registration successful (simulation)'\n        }); // 恢复原始返回\n      } catch (error) {\n        return Promise.reject(error); // 恢复原始错误处理\n      }\n    },\n    // 登出action\n    logout({\n      commit\n    }) {\n      commit('CLEAR_TOKEN');\n      commit('CLEAR_USER');\n      return Promise.resolve();\n    },\n    // 可选: 应用加载时尝试从token获取用户信息 (恢复为模拟逻辑)\n    async fetchUser({\n      commit,\n      state\n    }) {\n      // 恢复原始参数\n      if (state.token && !state.user) {\n        try {\n          // const response = await axios.get('/auth/me'); \n          // commit('SET_USER', response.data);\n          // 模拟获取用户信息\n          if (state.token.startsWith('fake-jwt-token-for-')) {\n            const usernameFromToken = state.token.replace('fake-jwt-token-for-', '');\n            commit('SET_USER', {\n              username: usernameFromToken,\n              role: 'USER'\n            });\n          } else {\n            // 如果不是已知的假token格式，并且没有用户信息，则清除\n            commit('CLEAR_TOKEN');\n            commit('CLEAR_USER');\n          }\n        } catch (error) {\n          commit('CLEAR_TOKEN'); // token无效则清除\n          commit('CLEAR_USER');\n        }\n      }\n    }\n  },\n  getters: {\n    isAuthenticated: state => !!state.token,\n    currentUser: state => state.user,\n    userRole: state => state.user ? state.user.role : null\n  }\n};\nexport default new Vuex.Store({\n  modules: {\n    auth: authModule\n  }\n  // 你可以在这里添加更多的模块\n});","map":{"version":3,"names":["Vue","Vuex","axios","use","authModule","namespaced","state","user","token","localStorage","getItem","mutations","SET_TOKEN","setItem","defaults","headers","common","CLEAR_TOKEN","removeItem","SET_USER","CLEAR_USER","actions","login","commit","credentials","response","Promise","resolve","setTimeout","data","username","role","error","reject","register","_context","userData","console","log","message","logout","fetchUser","startsWith","usernameFromToken","replace","getters","isAuthenticated","currentUser","userRole","Store","modules","auth"],"sources":["C:/Users/吴泽宇/Desktop/医院智慧能源管理系统/hospital-energy-management/frontend/src/store/index.js"],"sourcesContent":["import Vue from 'vue'\nimport Vuex from 'vuex'\nimport axios from 'axios';\n\nVue.use(Vuex)\n\nconst authModule = {\n  namespaced: true,\n  state: {\n    user: null, // 可以存储用户信息对象\n    token: localStorage.getItem('user-token') || ''\n  },\n  mutations: {\n    SET_TOKEN(state, token) {\n      state.token = token;\n      localStorage.setItem('user-token', token); // 持久化token\n      axios.defaults.headers.common['Authorization'] = `Bearer ${token}`; // 设置axios请求头\n    },\n    CLEAR_TOKEN(state) {\n      state.token = '';\n      localStorage.removeItem('user-token');\n      delete axios.defaults.headers.common['Authorization'];\n    },\n    SET_USER(state, user) {\n      state.user = user;\n      // 你也可以将用户信息存储在localStorage，但要注意敏感信息\n    },\n    CLEAR_USER(state) {\n      state.user = null;\n    }\n  },\n  actions: {\n    // 登录action (恢复为模拟API调用)\n    async login({ commit }, credentials) {\n      try {\n        // const response = await axios.post('/auth/signin', credentials);\n        // 模拟API调用成功\n        const response = await new Promise(resolve => setTimeout(() => resolve({\n          data: {\n            token: 'fake-jwt-token-for-' + credentials.username,\n            user: { username: credentials.username, role: 'USER' } // 模拟用户信息\n          }\n        }), 500));\n\n        const token = response.data.token;\n        const user = response.data.user;\n        commit('SET_TOKEN', token);\n        commit('SET_USER', user);\n        return Promise.resolve(user);\n      } catch (error) {\n        commit('CLEAR_TOKEN');\n        commit('CLEAR_USER');\n        return Promise.reject(error); // 恢复原始错误处理\n      }\n    },\n    // 注册action (恢复为模拟API调用)\n    async register(_context, userData) {\n      try {\n        // const response = await axios.post('/auth/signup', userData);\n        // 模拟API调用成功\n        console.log('Registering user (simulation):', userData);\n        await new Promise(resolve => setTimeout(() => resolve({ data: { message: 'Registration successful (simulation)'} }), 500));\n\n        return Promise.resolve({ message: 'Registration successful (simulation)'}); // 恢复原始返回\n      } catch (error) {\n        return Promise.reject(error); // 恢复原始错误处理\n      }\n    },\n    // 登出action\n    logout({ commit }) {\n      commit('CLEAR_TOKEN');\n      commit('CLEAR_USER');\n      return Promise.resolve();\n    },\n    // 可选: 应用加载时尝试从token获取用户信息 (恢复为模拟逻辑)\n    async fetchUser({ commit, state }) { // 恢复原始参数\n      if (state.token && !state.user) {\n        try {\n          // const response = await axios.get('/auth/me'); \n          // commit('SET_USER', response.data);\n          // 模拟获取用户信息\n          if (state.token.startsWith('fake-jwt-token-for-')){\n            const usernameFromToken = state.token.replace('fake-jwt-token-for-','');\n            commit('SET_USER', { username: usernameFromToken, role: 'USER' });\n          } else {\n            // 如果不是已知的假token格式，并且没有用户信息，则清除\n            commit('CLEAR_TOKEN');\n            commit('CLEAR_USER');\n          }\n        } catch (error) {\n          commit('CLEAR_TOKEN'); // token无效则清除\n          commit('CLEAR_USER');\n        }\n      }\n    }\n  },\n  getters: {\n    isAuthenticated: state => !!state.token,\n    currentUser: state => state.user,\n    userRole: state => state.user ? state.user.role : null\n  }\n}\n\nexport default new Vuex.Store({\n  modules: {\n    auth: authModule\n  }\n  // 你可以在这里添加更多的模块\n}) "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
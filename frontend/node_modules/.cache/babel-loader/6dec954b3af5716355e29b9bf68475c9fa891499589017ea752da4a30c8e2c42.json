{"ast":null,"code":"import Vue from 'vue';\nimport Vuex from 'vuex';\nimport axios from 'axios';\nVue.use(Vuex);\nconst authModule = {\n  namespaced: true,\n  state: {\n    user: null // 用户信息对象\n    // token: localStorage.getItem('user-token') || '' // No more token\n  },\n  mutations: {\n    // SET_TOKEN(state, token) { // No more token\n    //   state.token = token;\n    //   localStorage.setItem('user-token', token);\n    //   axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n    // },\n    // CLEAR_TOKEN(state) { // No more token\n    //   state.token = '';\n    //   localStorage.removeItem('user-token');\n    //   delete axios.defaults.headers.common['Authorization'];\n    // },\n    SET_USER(state, user) {\n      state.user = user; // user might be null to clear it\n      if (user) {\n        localStorage.setItem('user-info', JSON.stringify(user)); // Store user info\n      } else {\n        localStorage.removeItem('user-info'); // Clear user info\n      }\n    },\n    CLEAR_USER(state) {\n      // Combined into SET_USER(state, null)\n      state.user = null;\n      localStorage.removeItem('user-info');\n    }\n  },\n  actions: {\n    async login({\n      commit\n    }, credentials) {\n      try {\n        const response = await axios.post('/auth/signin', credentials);\n        // Backend now returns UserLoginResponse: { id, username, email, roles, message }\n        const userData = response.data;\n        if (userData && userData.username) {\n          // Check if login was successful based on response\n          const user = {\n            id: userData.id,\n            username: userData.username,\n            email: userData.email,\n            roles: userData.roles\n          };\n          commit('SET_USER', user);\n          return Promise.resolve(user);\n        } else {\n          // If backend doesn't send username, assume login failed or unexpected response\n          throw new Error(userData.message || 'Login failed: Unexpected response from server.');\n        }\n      } catch (error) {\n        commit('SET_USER', null); // Clear user on login failure\n        const errorMessage = error.response && error.response.data && error.response.data.message ? error.response.data.message : error.message || 'Login failed due to an unexpected error.';\n        return Promise.reject(new Error(errorMessage));\n      }\n    },\n    async register(_context, userData) {\n      try {\n        const response = await axios.post('/auth/signup', userData);\n        return Promise.resolve(response.data);\n      } catch (error) {\n        const errorMessage = error.response && error.response.data && error.response.data.message ? error.response.data.message : error.message || 'Registration failed due to an unexpected error.';\n        return Promise.reject(new Error(errorMessage));\n      }\n    },\n    logout({\n      commit\n    }) {\n      commit('SET_USER', null); // Clear user from state and localStorage\n      // No token to clear from axios headers anymore\n      return Promise.resolve();\n    },\n    fetchUser({\n      commit\n    }) {\n      // Simplified fetchUser\n      const storedUser = localStorage.getItem('user-info');\n      if (storedUser) {\n        try {\n          const user = JSON.parse(storedUser);\n          commit('SET_USER', user); // Restore user from localStorage\n        } catch (e) {\n          localStorage.removeItem('user-info'); // Corrupted data\n        }\n      }\n    }\n  },\n  getters: {\n    isAuthenticated: state => !!state.user,\n    // Authenticated if user object exists\n    currentUser: state => state.user,\n    userRole: state => state.user && state.user.roles && state.user.roles.length > 0 ? state.user.roles[0] : null\n  }\n};\nexport default new Vuex.Store({\n  modules: {\n    auth: authModule\n  }\n  // 你可以在这里添加更多的模块\n});","map":{"version":3,"names":["Vue","Vuex","axios","use","authModule","namespaced","state","user","mutations","SET_USER","localStorage","setItem","JSON","stringify","removeItem","CLEAR_USER","actions","login","commit","credentials","response","post","userData","data","username","id","email","roles","Promise","resolve","Error","message","error","errorMessage","reject","register","_context","logout","fetchUser","storedUser","getItem","parse","e","getters","isAuthenticated","currentUser","userRole","length","Store","modules","auth"],"sources":["C:/Users/吴泽宇/Desktop/医院智慧能源管理系统/hospital-energy-management/frontend/src/store/index.js"],"sourcesContent":["import Vue from 'vue'\nimport Vuex from 'vuex'\nimport axios from 'axios';\n\nVue.use(Vuex)\n\nconst authModule = {\n  namespaced: true,\n  state: {\n    user: null, // 用户信息对象\n    // token: localStorage.getItem('user-token') || '' // No more token\n  },\n  mutations: {\n    // SET_TOKEN(state, token) { // No more token\n    //   state.token = token;\n    //   localStorage.setItem('user-token', token);\n    //   axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n    // },\n    // CLEAR_TOKEN(state) { // No more token\n    //   state.token = '';\n    //   localStorage.removeItem('user-token');\n    //   delete axios.defaults.headers.common['Authorization'];\n    // },\n    SET_USER(state, user) {\n      state.user = user; // user might be null to clear it\n      if (user) {\n        localStorage.setItem('user-info', JSON.stringify(user)); // Store user info\n      } else {\n        localStorage.removeItem('user-info'); // Clear user info\n      }\n    },\n    CLEAR_USER(state) { // Combined into SET_USER(state, null)\n      state.user = null;\n      localStorage.removeItem('user-info');\n    }\n  },\n  actions: {\n    async login({ commit }, credentials) {\n      try {\n        const response = await axios.post('/auth/signin', credentials);\n        // Backend now returns UserLoginResponse: { id, username, email, roles, message }\n        const userData = response.data; \n        if (userData && userData.username) { // Check if login was successful based on response\n          const user = {\n            id: userData.id,\n            username: userData.username,\n            email: userData.email,\n            roles: userData.roles\n          };\n          commit('SET_USER', user);\n          return Promise.resolve(user);\n        } else {\n          // If backend doesn't send username, assume login failed or unexpected response\n          throw new Error(userData.message || 'Login failed: Unexpected response from server.');\n        }\n      } catch (error) {\n        commit('SET_USER', null); // Clear user on login failure\n        const errorMessage = error.response && error.response.data && error.response.data.message \n                           ? error.response.data.message \n                           : (error.message || 'Login failed due to an unexpected error.');\n        return Promise.reject(new Error(errorMessage));\n      }\n    },\n    async register(_context, userData) {\n      try {\n        const response = await axios.post('/auth/signup', userData);\n        return Promise.resolve(response.data); \n      } catch (error) {\n        const errorMessage = error.response && error.response.data && error.response.data.message\n                           ? error.response.data.message\n                           : (error.message || 'Registration failed due to an unexpected error.');\n        return Promise.reject(new Error(errorMessage));\n      }\n    },\n    logout({ commit }) {\n      commit('SET_USER', null); // Clear user from state and localStorage\n      // No token to clear from axios headers anymore\n      return Promise.resolve();\n    },\n    fetchUser({ commit }) { // Simplified fetchUser\n      const storedUser = localStorage.getItem('user-info');\n      if (storedUser) {\n        try {\n          const user = JSON.parse(storedUser);\n          commit('SET_USER', user); // Restore user from localStorage\n        } catch (e) {\n          localStorage.removeItem('user-info'); // Corrupted data\n        }\n      }\n    }\n  },\n  getters: {\n    isAuthenticated: state => !!state.user, // Authenticated if user object exists\n    currentUser: state => state.user,\n    userRole: state => (state.user && state.user.roles && state.user.roles.length > 0) ? state.user.roles[0] : null\n  }\n}\n\nexport default new Vuex.Store({\n  modules: {\n    auth: authModule\n  }\n  // 你可以在这里添加更多的模块\n}) "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}